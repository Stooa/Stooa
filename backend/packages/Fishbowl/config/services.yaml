# This file is part of the Stooa codebase.
#
# (c) 2020 - present Runroom SL
#
# For the full copyright and license information, please view the LICENSE
# file that was distributed with this source code.

services:
    _defaults:
        autowire: true
        autoconfigure: true

    App\Fishbowl\:
        resource: ../src/
        exclude:
            - ../src/DependencyInjection/
            - ../src/Entity/

    App\Fishbowl\Controller\:
        resource: ../src/Controller/
        tags: [controller.service_arguments]

    App\Fishbowl\State\FishbowlProcessor:
        bind:
            $decorated: '@api_platform.doctrine.orm.state.persist_processor'

    App\Fishbowl\Stage\FishbowlValidateStage:
        decorates: api_platform.graphql.resolver.stage.validate

    App\Fishbowl\State\FishbowlStateProvider:
        bind:
            $collectionProvider: '@api_platform.doctrine.orm.state.collection_provider'

    App\Fishbowl\Service\AttendeeMailerService:
        bind:
            $from: '%env(MAILER_FROM)%'
            $appUrl: '%env(APP_URL)%'

    App\Fishbowl\Service\OpenAI\AskSummaryService:
        bind:
            $apiKey: '%env(OPENAI_API_KEY)%'
            $assistantId: '%env(OPENAI_ASSISTANT_ID)%'

    App\Fishbowl\Service\OpenAI\UploadFileService:
        bind:
            $apiKey: '%env(OPENAI_API_KEY)%'

    App\Fishbowl\Service\OpenAI\GetSummaryService:
        bind:
            $apiKey: '%env(OPENAI_API_KEY)%'

    #Admin
    App\Fishbowl\Admin\FishbowlAdmin:
        tags:
            - { name: sonata.admin, model_class: App\Fishbowl\Entity\Fishbowl, manager_type: orm, label: Fishbowls }
        calls:
            - [ setFishbowlService, [ '@App\Fishbowl\Service\FishbowlService' ] ]

    App\Fishbowl\Admin\FeedbackAdmin:
        tags:
            - { name: sonata.admin, model_class: App\Fishbowl\Entity\Feedback, manager_type: orm, label: Feedbacks }

    App\Fishbowl\Admin\AttendeeAdmin:
        tags:
            - { name: sonata.admin, model_class: App\Fishbowl\Entity\Attendee, manager_type: orm, label: Attendees }
